<!DOCTYPE html>
<html>
    <head>
        <style>
            html, body, #map {
                padding:0;
                margin:0;
                width:100%;
                height:100%;
            }
        </style>
        <link href="../node_modules/maplibre-gl/dist/maplibre-gl.css" rel="stylesheet"/>
        <script src="../node_modules/maplibre-gl/dist/maplibre-gl.js"></script>
        <!-- Maplibre ArcGIS -->
        <script src="../dist/maplibre-arcgis-debug.js"></script>

    </head>
    <body>
        <div id="map"></div>
        <script src="../debug/apikey.js"></script>
        <script>

            const basemapsKey = apiKey;
            const vectorTileKey = vectorTileApiKey;

            const basemapStyle = new maplibreArcGIS.BasemapStyle('arcgis/light-gray', {
                accessToken: basemapsKey
            });
            const map = new maplibregl.Map({
                container: "map", // the id of the div element
                style: basemapStyle.styleUrl,
                zoom: 4.5, // starting zoom
                center: [-96.8, 37.5], // starting location [longitude, latitude]
                attributionControl:false
            });
            map.addControl(new maplibreArcGIS.AttributionControl());
           
            // Secure layers are supported as well, DM me for a testing key
            // Also, zoom out if you're testing this layer
            const vectorTileServiceAuth = {
                serviceUrl:'https://vectortileservices3.arcgis.com/GVgbJbqm8hXASVYi/arcgis/rest/services/USA_States_Population_st_(vector_tile)/VectorTileServer/',
                itemId:'5f819bf99d7c4a9da521405dab53b084',
                serviceItemId:'aaf3581893ba46d1a9c24bbaa68884f0'
            };

            map.on('load',async () => {

                const vectorTileService = await maplibreArcGIS.VectorTileService.create(vectorTileServiceAuth.itemId,{
                    accessToken:vectorTileKey
                });
                
                map.addSource(vectorTileService.id,vectorTileService.source);
                vectorTileService.layers.forEach(layer => {
                        map.addLayer(layer);
                });
            });

            // Item ID: 5f819bf99d7c4a9da521405dab53b084
            // Service URL also works: 'https://vectortileservices3.arcgis.com/GVgbJbqm8hXASVYi/arcgis/rest/services/USA_States_Population_st_(vector_tile)/VectorTileServer'

        </script>
    </body>
</html>