<!DOCTYPE html>
<html>
    <head>
        <style>
            html, body, #map {
                padding:0;
                margin:0;
                width:100%;
                height:100%;
            }
        </style>
        <link href="../node_modules/maplibre-gl/dist/maplibre-gl.css" rel="stylesheet"/>
        <script src="../node_modules/maplibre-gl/dist/maplibre-gl.js"></script>
        <!-- Maplibre ArcGIS -->
        <script src="../dist/maplibre-arcgis-debug.js"></script>

    </head>
    <body>
        <div id="map"></div>
        <script src="../debug/apikey.js"></script>
        <script>

            const map = new maplibregl.Map({
                container: "map", // the id of the div element
                zoom: 12, // starting zoom
                center: [-118.805, 34.027] // starting location [longitude, latitude]
            });
            const style = new maplibreArcGIS.BasemapStyle('arcgis/outdoor', {
                accessToken: apiKey
            }).applyStyleTo(map);

            const pointService = "https://services3.arcgis.com/GVgbJbqm8hXASVYi/arcgis/rest/services/Trailheads/FeatureServer/0";
            const lineService = "https://services3.arcgis.com/GVgbJbqm8hXASVYi/arcgis/rest/services/Trails/FeatureServer/0"

            const polygonService = "https://services3.arcgis.com/GVgbJbqm8hXASVYi/arcgis/rest/services/Parks_and_Open_Space/FeatureServer/0";
            // query?where=1%3D1&outFields=*&returnGeometry=true&f=pgeojson

            map.on('load',async () => {

                // Load trailheads from service URL
                const trailheads = await maplibreArcGIS.FeatureLayer.fromUrl(pointService);
                trailheads.addSourcesAndLayersTo(map);

                // Load trails from service URL and query
                const trails = await maplibreArcGIS.FeatureLayer.fromUrl(lineService,{
                    query:{ // Query parameter supported with layer URLs
                        outFields:['TRL_ID','ELEV_MIN','ELEV_MAX'],
                        where:'ELEV_MIN > 200'
                    }
                });
                trails.addSourcesAndLayersTo(map);

                // Load parks from from portal item ID
                const parks = await maplibreArcGIS.FeatureLayer.fromPortalItem('f2ea5d874dad427294641d2d45097c0e');
                parks.addSourcesAndLayersTo(map);
            });
    
        </script>
    </body>
</html>